<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome</title>
</head>
<body>

    <h1>Welcome to my website!</h1>

    <img src="assets/Andy.png" alt="Andy Warhol" width="300">

    <p>
        Click here for more info:
        <a
            href="warhol-bio.html"
            data-track="Andy Warhol Biography"
        >
            Andy Warhol Biography
        </a>
    </p>

    <h2>Lots</h2>
    <div id="lots"></div>

    <script>
        const TRACK_ENDPOINT =
            "https://sv1vmmuwf2.execute-api.eu-west-2.amazonaws.com/click";

        function trackClick(label, url) {
            fetch(TRACK_ENDPOINT, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    label: label,
                    url: url
                }),
                keepalive: true
            }).catch(() => {});
        }

        document.addEventListener("click", e => {
            const link = e.target.closest("a[data-track]");
            if (!link) return;
            trackClick(link.dataset.track, link.href);
        });

        fetch("https://jawo8dkwpi.execute-api.eu-west-2.amazonaws.com/lots")
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById("lots");

                data.forEach(lot => {
                    const div = document.createElement("div");

                    const searchUrl =
                        "https://www.google.com/search?q=" +
                        encodeURIComponent(lot.lotitle);

                    div.innerHTML = `
                        <h3>
                            <a
                                href="${searchUrl}"
                                target="_blank"
                                rel="noopener noreferrer"
                                data-track="${lot.lotitle}"
                            >
                                ${lot.lotitle}
                            </a>
                        </h3>
                        <p>${lot.lotdescription}</p>
                        <p><strong>Price:</strong> ${lot.priceresult} ${lot.currencycode}</p>
                        <p><strong>Auction:</strong> ${lot.housename}</p>
                        <hr>
                    `;

                    container.appendChild(div);
                });
            })
            .catch(err => {
                console.error(err);
            });
    </script>

</body>
</html>
